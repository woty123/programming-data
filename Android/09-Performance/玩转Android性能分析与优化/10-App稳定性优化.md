[国内Top团队大牛带你玩转Android性能分析与优化](https://coding.imooc.com/class/308.html)

# 11 App稳定性优化

## 11. 1 如何提升App的稳定性

- 稳定性是个大问题，Crash 是 P0 优先级的
- 稳定性可优化面很广

稳定性维度:

- Crash 维度
- 性能维度
- 业务可用性维度

稳定性优化:

- 重在预防，监控必不可少
- 思考更深一层，重视隐含信息，不要只看表现信息，深挖异常根源。
- 长期保持需要科学流程

## 11. 2 高Crash率的破解之道

### Crash指标

- UV、PV Crash 率
- 启动 Crash 率
- 增量、存量 Crash 率
- Crash 率评估
  - 务必在千分之二以下
  - Crash 率万分位为优秀

### Crash 关键问题

- 尽可能还原 Crash 现场
- 责任归属
  - 专项小组轮班
  - 自动匹配分配
  - 处理流程全记录

### Crash 治理整体结构

- 采集层：错误堆栈、设备信息、行为日志、其他信息
- 处理层：数据清洗、数据聚合、维度分析、趋势对比
- 展示层：数据还原、维度信息、起使版本、其他信息
- 报警层：环比、同比、邮件通知

## 11. 3 移动端业务高可用方案建设

业务高可用没有像 Crash 那用的回调，只能透过代码埋点统计关键节点

### 数据采集

- 梳理项目主流程、核心路径、关键节点
- Aop 自动采集、统一上报
- 报警策略
  - 阈值报警
  - 趋势报警
  - 特定模块，立即上报
- 业务异常监控

```java
//类型1：
        // 以下代码是为了演示业务不正常场景下的监控
        try {
            // 一些业务处理
            Log.i("", "");
        } catch (Exception e) {
            //统计业务异常
            ExceptionMonitor.monitor(Log.getStackTraceString(e));
        }

//类型2：
        boolean flag = true;
        if (flag) {
            // 正常，继续执行流程
        } else {
            ExceptionMonitor.monitor("异常流程原因");
        }
```

- 兜底策略
  - 配置中心，动态开关功能
  - 动态路由配置，native 业务不可用则跳转到 H5 实现或者异常处理页面

## 11. 4 移动端容灾方案

- 功能开关，异常时关闭功能入口
- 统一跳转中心：native 业务不可用则跳转到 H5 实现或者异常处理页面
- 热修复：可监控、可灰度、可回滚、可清除
- 安全模式

## 11. 5 稳定性长效治理

- 开发阶段
  - 统一编码规范、技术评审、CodeReview、静态代码检测
  - 架构优化：能力收敛，统一容错
- 测试阶段
- 合码阶段
  - 编译检测，静态扫描
  - 独立分支编译检测
- 发布阶段
  - 多轮灰度
  - 分场景、维度全面覆盖
- 运维阶段

## 11. 6 稳定性优化模拟面试

1. 你们做了哪些稳定性优化？
   1. Crash 专项优化
   2. 性能稳定性优化
   3. 业务稳定性优化
2. 性能优化怎么做的？
   1. 线下发现问题，优化为主
   2. 线上监控为主
   3. Crash 专项治理
3. 业务稳定性如何保障？
   1. 数据采集 + 报警
   2. 异常监控 | 单点追踪
   3. 兜底策略
4. 如果发生了异常情况，怎么快速止损
   1. 能力：功能开关、统一跳转
   2. 热修复
   3. 安全模式
